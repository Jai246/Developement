<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <!-- <link rel="stylesheet" href="logic.js"> -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class = "tools" style = "cursor : pointer">
        <!-- <i class="fas fa-square fa-3x"></i>
        <i class="fas fa-grip-lines-vertical fa-3x"></i> -->
        <div class="pencil">
            <img class = "img" src="pencil.png">
        </div>
        <div class="eraser">
            <img class = "img" src="eraser.png">
        </div>
        <div class="undo">
            <img class = "img" src="undo.png">
        </div>
        <div class="redo">
            <img class = "img" src="redo.png">
        </div>
        <div class="note">
            <img class = "img" src="note.png">
        </div>
        <div class="shape">
            <img class = "img" src="shapes.png">
        </div>
        <div class="color red" style = "cursor : url('pencil.png'),auto"> </div>
        <div class="color pink"></div>
        <div class="color black"></div>
        <div class="color blue"></div>
        <div class="color green"></div>

    </div>
    <canvas class="canva"></canvas>
    
</body>
<script>
    let canvasBoard = document.querySelector(".canva");
    // let rectTool = document.querySelector(".fa-square");
    let lineTool = document.querySelector(".pencil");
    let eraser = document.querySelector(".eraser");
    let body = document.querySelector("body");
    let cTool = "lineTool";
    let drawingMode = false;
    let colors = document.querySelectorAll(".color");
    let points = [];
    let beginPoint;
    // default height width is smaller 
    canvasBoard.height = window.innerHeight;
    canvasBoard.width = window.innerWidth;
    // this line gives you the tool to draw on that canvas
    let tool = canvasBoard.getContext("2d");
    tool.lineCap = 'round';
    tool.lineJoin = 'round';
    tool.lineWidth = 2.2;
    tool.strokeStyle = 'rgb(109, 203, 235)';


    for(let i = 0;i<colors.length; i++)
    {
        colors[i].addEventListener("click",function(e){
            let target = e.target;
            let classList = target.classList;

            if(classList[1] == 'red'){
                tool.strokeStyle = 'red';
            }
            else if(classList[1] == 'pink'){
                tool.strokeStyle = 'pink';
            }
            else if(classList[1] == 'black'){
                tool.strokeStyle = 'black';
            }
            else if(classList[1] == 'red'){
                tool.strokeStyle = 'red';
            }
            else if(classList[1] == 'blue'){
                tool.strokeStyle = 'rgb(134, 208, 233)';
            }
            else if(classList[1] == 'green'){
                tool.strokeStyle = 'Lightgreen';
            }
        })
    }


    // tool change logic
    // rectTool.addEventListener("click", function () 
    // {
    //     cTool = "rectTool";
    // })
    eraser.addEventListener("click",function(){
        cTool = "eraser";
        canvasBoard.style.cursor = "url('cursorEraser.png') -30 35, auto";
        tool.strokeStyle = "#ffffff";
        tool.lineWidth = 30;

    })
    lineTool.addEventListener("click", function () 
    {
        canvasBoard.style.cursor = "url('cursorPencil.png') -35 35, auto";
        cTool = "lineTool";
    })


    // canavas board -> top point kitna niche hai 
    let boardTop = canvasBoard.getBoundingClientRect().top;
    // canavas board -> left  point kitna aage  hai 
    let boardLeft = canvasBoard.getBoundingClientRect().left;

    let iX, iY, fX, fY;

    body.addEventListener("mousedown",function (e)
    {
        if(tool.strokeStyle == "#ffffff" && cTool!="eraser")
        {
            console.log("changed");
            tool.strokeStyle = 'rgb(134, 208, 233)';
        }
        if(tool.lineWidth == 30 && cTool!="eraser") {
            tool.lineWidth = 2.2;
            console.log("changedWidth");
        }
        drawingMode = true;
        iX = e.clientX-boardLeft;
        iY = e.clientY+boardTop;
        let po = {
            x : iX,
            y : iY
        }
        points.push(po);
        beginPoint = po;
    })
    // Stroke Style Befire Using Eraser
    let prevStrokeStyle = "";
    let prevStrokeSize = 0;
    body.addEventListener("mousemove", function (e)
    {
        if (drawingMode == false) return;

        fX = e.clientX - boardLeft;
        fY = e.clientY - boardTop;
        
        let po = {
            x : fX,
            y : fY
        }

        points.push(po);

        if (points.length > 3) 
        {
            const lastTwoPoints = points.slice(-2);
            const controlPoint = lastTwoPoints[0];
            const endPoint = {
                x: (lastTwoPoints[0].x + lastTwoPoints[1].x) / 2,
                y: (lastTwoPoints[0].y + lastTwoPoints[1].y) / 2,
            }
            tool.beginPath();
            tool.moveTo(beginPoint.x, beginPoint.y);
            tool.quadraticCurveTo(controlPoint.x, controlPoint.y, endPoint.x, endPoint.y);
            tool.stroke();
            tool.closePath();
            beginPoint = endPoint;
            
        }

        iX = fX;
        iY = fY;
    })

    body.addEventListener("mouseup", function (e)
    {
        fX = e.clientX-boardLeft;
        fY = e.clientY+boardTop;
        let width = fX - iX;
        let height = fY - iY;
        if (cTool == "rectTool") 
        {
            tool.strokeRect(iX, iY, width, height);
        } 
        else if(cTool == "lineTool" || cTool == "eraser")
        {
            
            const {x,y} = {width, height};
            points.push({x,y});
            if (points.length > 3) 
            {
                const lastTwoPoints = points.slice(-2);
                const controlPoint = lastTwoPoints[0];
                const endPoint = lastTwoPoints[1];
                tool.beginPath();
                tool.moveTo(beginPoint.x, beginPoint.y);
                tool.quadraticCurveTo(controlPoint.x, controlPoint.y, endPoint.x, endPoint.y);
                tool.stroke();
                tool.closePath();
                beginPoint = endPoint;
            }
        }
        tool.beginPath();
        beginPoint = null;
        points = [];
        drawingMode = false;
    })

    </script>
</html>